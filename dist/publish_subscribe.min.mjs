var t="[object Arguments]",e="[object Function]",n="[object GeneratorFunction]",r="[object Map]",i="[object Set]",o=/\w*$/,c=/^\[object .+?Constructor\]$/,s=/^(?:0|[1-9]\d*)$/,a={};a[t]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object DataView]"]=a["[object Boolean]"]=a["[object Date]"]=a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a[r]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a[i]=a["[object String]"]=a["[object Symbol]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Error]"]=a[e]=a["[object WeakMap]"]=!1;var l="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,h=l||u||Function("return this")(),_="object"==typeof exports&&exports&&!exports.nodeType&&exports,b=_&&"object"==typeof module&&module&&!module.nodeType&&module,f=b&&b.exports===_;function g(t,e){return t.set(e[0],e[1]),t}function p(t,e){return t.add(e),t}function d(t,e,n,r){var i=-1,o=t?t.length:0;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function y(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function v(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function j(t,e){return function(n){return t(e(n))}}function k(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var w,A=Array.prototype,C=Function.prototype,m=Object.prototype,O=h["__core-js_shared__"],S=(w=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"",L=C.toString,V=m.hasOwnProperty,E=m.toString,x=RegExp("^"+L.call(V).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),B=f?h.Buffer:void 0,P=h.Symbol,T=h.Uint8Array,F=j(Object.getPrototypeOf,Object),I=Object.create,U=m.propertyIsEnumerable,M=A.splice,D=Object.getOwnPropertySymbols,$=B?B.isBuffer:void 0,N=j(Object.keys,Object),R=bt(h,"DataView"),W=bt(h,"Map"),z=bt(h,"Promise"),G=bt(h,"Set"),q=bt(h,"WeakMap"),H=bt(Object,"create"),J=yt(R),K=yt(W),Q=yt(z),X=yt(G),Y=yt(q),Z=P?P.prototype:void 0,tt=Z?Z.valueOf:void 0;function et(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function nt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function rt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function it(t){this.__data__=new nt(t)}function ot(e,n){var r=jt(e)||function(e){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&kt(t)}(e)&&V.call(e,"callee")&&(!U.call(e,"callee")||E.call(e)==t)}(e)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(e.length,String):[],i=r.length,o=!!i;for(var c in e)!n&&!V.call(e,c)||o&&("length"==c||pt(c,i))||r.push(c);return r}function ct(t,e,n){var r=t[e];V.call(t,e)&&vt(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function st(t,e){for(var n=t.length;n--;)if(vt(t[n][0],e))return n;return-1}function at(c,s,l,u,h,_,b){var f;if(u&&(f=_?u(c,h,_,b):u(c)),void 0!==f)return f;if(!Ct(c))return c;var j=jt(c);if(j){if(f=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&V.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(c),!s)return function(t,e){var n=-1,r=t.length;e||(e=Array(r));for(;++n<r;)e[n]=t[n];return e}(c,f)}else{var w=gt(c),A=w==e||w==n;if(wt(c))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(c,s);if("[object Object]"==w||w==t||A&&!_){if(y(c))return _?c:{};if(f=function(t){return"function"!=typeof t.constructor||dt(t)?{}:(e=F(t),Ct(e)?I(e):{});var e}(A?{}:c),!s)return function(t,e){return ht(t,ft(t),e)}(c,function(t,e){return t&&ht(e,mt(e),t)}(f,c))}else{if(!a[w])return _?c:{};f=function(t,e,n,c){var s=t.constructor;switch(e){case"[object ArrayBuffer]":return ut(t);case"[object Boolean]":case"[object Date]":return new s(+t);case"[object DataView]":return function(t,e){var n=e?ut(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,c);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var n=e?ut(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,c);case r:return function(t,e,n){return d(e?n(v(t),!0):v(t),g,new t.constructor)}(t,c,n);case"[object Number]":case"[object String]":return new s(t);case"[object RegExp]":return function(t){var e=new t.constructor(t.source,o.exec(t));return e.lastIndex=t.lastIndex,e}(t);case i:return function(t,e,n){return d(e?n(k(t),!0):k(t),p,new t.constructor)}(t,c,n);case"[object Symbol]":return a=t,tt?Object(tt.call(a)):{}}var a}(c,w,at,s)}}b||(b=new it);var C=b.get(c);if(C)return C;if(b.set(c,f),!j)var m=l?function(t){return function(t,e,n){var r=e(t);return jt(t)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(t))}(t,mt,ft)}(c):mt(c);return function(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););}(m||c,(function(t,e){m&&(t=c[e=t]),ct(f,e,at(t,s,l,u,e,c,b))})),f}function lt(t){return!(!Ct(t)||(e=t,S&&S in e))&&(At(t)||y(t)?x:c).test(yt(t));var e}function ut(t){var e=new t.constructor(t.byteLength);return new T(e).set(new T(t)),e}function ht(t,e,n,r){n||(n={});for(var i=-1,o=e.length;++i<o;){var c=e[i],s=r?r(n[c],t[c],c,n,t):void 0;ct(n,c,void 0===s?t[c]:s)}return n}function _t(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function bt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return lt(n)?n:void 0}et.prototype.clear=function(){this.__data__=H?H(null):{}},et.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},et.prototype.get=function(t){var e=this.__data__;if(H){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return V.call(e,t)?e[t]:void 0},et.prototype.has=function(t){var e=this.__data__;return H?void 0!==e[t]:V.call(e,t)},et.prototype.set=function(t,e){return this.__data__[t]=H&&void 0===e?"__lodash_hash_undefined__":e,this},nt.prototype.clear=function(){this.__data__=[]},nt.prototype.delete=function(t){var e=this.__data__,n=st(e,t);return!(n<0)&&(n==e.length-1?e.pop():M.call(e,n,1),!0)},nt.prototype.get=function(t){var e=this.__data__,n=st(e,t);return n<0?void 0:e[n][1]},nt.prototype.has=function(t){return st(this.__data__,t)>-1},nt.prototype.set=function(t,e){var n=this.__data__,r=st(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},rt.prototype.clear=function(){this.__data__={hash:new et,map:new(W||nt),string:new et}},rt.prototype.delete=function(t){return _t(this,t).delete(t)},rt.prototype.get=function(t){return _t(this,t).get(t)},rt.prototype.has=function(t){return _t(this,t).has(t)},rt.prototype.set=function(t,e){return _t(this,t).set(t,e),this},it.prototype.clear=function(){this.__data__=new nt},it.prototype.delete=function(t){return this.__data__.delete(t)},it.prototype.get=function(t){return this.__data__.get(t)},it.prototype.has=function(t){return this.__data__.has(t)},it.prototype.set=function(t,e){var n=this.__data__;if(n instanceof nt){var r=n.__data__;if(!W||r.length<199)return r.push([t,e]),this;n=this.__data__=new rt(r)}return n.set(t,e),this};var ft=D?j(D,Object):function(){return[]},gt=function(t){return E.call(t)};function pt(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||s.test(t))&&t>-1&&t%1==0&&t<e}function dt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||m)}function yt(t){if(null!=t){try{return L.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function vt(t,e){return t===e||t!=t&&e!=e}(R&&"[object DataView]"!=gt(new R(new ArrayBuffer(1)))||W&&gt(new W)!=r||z&&"[object Promise]"!=gt(z.resolve())||G&&gt(new G)!=i||q&&"[object WeakMap]"!=gt(new q))&&(gt=function(t){var e=E.call(t),n="[object Object]"==e?t.constructor:void 0,o=n?yt(n):void 0;if(o)switch(o){case J:return"[object DataView]";case K:return r;case Q:return"[object Promise]";case X:return i;case Y:return"[object WeakMap]"}return e});var jt=Array.isArray;function kt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!At(t)}var wt=$||function(){return!1};function At(t){var r=Ct(t)?E.call(t):"";return r==e||r==n}function Ct(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function mt(t){return kt(t)?ot(t):function(t){if(!dt(t))return N(t);var e=[];for(var n in Object(t))V.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}const Ot=()=>{},St="[object AsyncFunction]",Lt="[object Function]";function Vt(t,e){if(t)switch(xt(t)){case St:t(...e).then(()=>{}).catch(()=>{});break;case Lt:try{t(...e)}catch(t){}}}function Et(t){return function(t){return Object(t)!==t}(t)?t:function(t){return at(t,!0,!0)}(t)}function xt(t){return Object.prototype.toString.call(t)}function Bt(t){return 0===function(t){return Ft(t).length}(t)}function Pt(t,e){return Object.is(t,e)}function Tt(){return Object.create(null)}function Ft(t){return Object.keys(t)}class It{callback;channel;once;token;constructor(t,e,n=!1){this.callback=e,this.channel=t,this.once=n,this.token=function(){const t=new Array(16);for(let e=0;e<16;e+=1)t[e]="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[Math.floor(62*Math.random())];return t.join("")}()}}class Ut{__channels=new G;__createChannel;__createSubscription;__hasLogging;__isValidCallback;__isValidChannel;__isValidToken;__logging;__onPublish;__subscriptions=new W;constructor(){this.__isValidCallback=function(t){return!!t&&[St,Lt].includes(xt(t))}.bind(this),this.__isValidChannel=function(t){return"string"==typeof t||"symbol"==typeof t||"number"==typeof t&&Number.isFinite(t)}.bind(this),this.__isValidToken=function(t){return"string"==typeof t&&16===t.length}.bind(this),this.__createChannel=function(t){this.hasChannel(t)||(this.__channels.add(t),this.__subscriptions.set(t,Tt()))}.bind(this),this.__createSubscription=function(t,e,n){const r=new It(t,e,n);return this.__subscriptions.get(t)[r.token]=r,r.token}.bind(this),this.disableLogging(),this.dropAll(),this.onPublish()}disableLogging(){this.__logging=Ot,this.__hasLogging=!1}dropAll(){this.__logging("dropAll"),this.__channels.clear(),this.__subscriptions.clear()}dropChannel(t){this.__logging("dropChannel",{channel:t}),this.hasChannel(t)&&(this.__channels.delete(t),this.__subscriptions.set(t,Tt()))}getCallback(t){if(!this.__isValidToken(t))return;let e=void 0;return Array.from(this.__subscriptions.values()).some(n=>t in n&&(e=n[t].callback,!0)),e}getChannels(){return Array.from(this.__channels).filter(t=>"symbol"!=typeof t).sort((t,e)=>t.localeCompare(e))}hasChannel(t){return this.__channels.has(t)}hasSubscription(t){return!!this.hasChannel(t)&&(!!this.__subscriptions.has(t)&&!Bt(this.__subscriptions.get(t)))}onPublish(t){void 0!==t?this.__isValidCallback(t)&&(this.__onPublish=(e,n)=>{Vt(t,[e,n])}):this.__onPublish=Ot}publish(t,e,n=!0){let r;if(r=n?()=>Et(e):()=>e,this.__logging("publish",{channel:t,data:r()}),this.__onPublish(t,r()),!this.hasChannel(t))return;const i=[],o=this.__subscriptions.get(t);Ft(o).forEach(e=>{const n=o[e],c=n.callback;switch(xt(c)){case St:i.push(new z(i=>{let s;this.__hasLogging&&this.__logging("publish -> send",{channel:t,data:r(),token:e}),c(r(),t,e).then(r=>{s={channel:t,result:r,token:e},i(s),this.__hasLogging&&this.__logging("publish -> receive",{channel:t,result:Et(r),token:e}),n.once&&delete o[e]}).catch(r=>{s={channel:t,result:r,token:e},i(s),this.__hasLogging&&this.__logging("publish -> receive",{channel:t,result:r,token:e}),n.once&&delete o[e]})}));break;case Lt:i.push(new z(i=>{let s;this.__hasLogging&&this.__logging("publish -> send",{channel:t,data:r(),token:e});try{s=c(r(),t,e)}catch(t){s=t}i({channel:t,result:s,token:e}),this.__hasLogging&&this.__logging("publish -> receive",{channel:t,result:Et(s),token:e}),n.once&&delete o[e]}))}}),z.all(i).then(()=>{})}publishAsync(t,e,n=!0,r=!0){let i;if(i=r?()=>Et(e):()=>e,this.__hasLogging&&this.__logging("publishAsync",{channel:t,data:i()}),this.__onPublish(t,i()),!this.hasChannel(t))return z.all([]);const o=[],c=this.__subscriptions.get(t);return Ft(c).forEach(e=>{const n=c[e],r=n.callback;switch(xt(r)){case St:o.push(new z(o=>{let s;this.__hasLogging&&this.__logging("publishAsync -> send",{channel:t,data:i(),token:e}),r(i(),t,e).then(r=>{s={channel:t,result:r,token:e},o(s),this.__hasLogging&&this.__logging("publishAsync -> receive",{channel:t,result:Et(r),token:e}),n.once&&delete c[e]}).catch(r=>{s={channel:t,result:r,token:e},o(s),this.__hasLogging&&this.__logging("publishAsync -> receive",{channel:t,result:r,token:e}),n.once&&delete c[e]})}));break;case Lt:o.push(new z(o=>{let s;this.__hasLogging&&this.__logging("publishAsync -> send",{channel:t,data:i(),token:e});try{s=r(i(),t,e)}catch(t){s=t}o({channel:t,result:s,token:e}),this.__hasLogging&&this.__logging("publishAsync -> receive",{channel:t,result:Et(s),token:e}),n.once&&delete c[e]}))}}),n?z.all(o).then(t=>t.map(t=>t.result)):z.all(o)}publishSync(t,e,n=!0,r=!0,i){let o,c;if(o=r?()=>Et(e):()=>e,this.__hasLogging&&this.__logging("publishSync",{channel:t,data:o()}),this.__onPublish(t,o()),c=i&&this.__isValidCallback(i)?t=>Vt(i,[t]):()=>{},!this.hasChannel(t))return c([]),[];const s=this.__subscriptions.get(t);let a=[];return Ft(s).forEach(e=>{const n=s[e],r=n.callback;if(xt(r)!==Lt)return;let i;this.__hasLogging&&this.__logging("publishSync -> send",{channel:t,data:o(),token:e});try{i=r(o(),t,e)}catch(t){i=t}a.push({channel:t,result:i,token:e}),this.__hasLogging&&this.__logging("publishSync -> receive",{channel:t,result:Et(i),token:e}),n.once&&delete s[e]}),n&&(a=a.map(t=>t.result)),c(a),a}setLogging(t){if(this.__isValidCallback(t))switch(xt(t)){case St:this.__logging=(e,n)=>{t({...n,method:e}).then(()=>{}).catch(()=>{})},this.__hasLogging=!0;break;case Lt:this.__logging=(e,n)=>{try{t({...n,method:e})}catch(t){}},this.__hasLogging=!0}}subscribe(t,e,n=!1){return this.__logging("subscribe",{channel:t,callback:e,once:n}),this.__isValidChannel(t)?this.__isValidCallback(e)?(this.__createChannel(t),this.__createSubscription(t,e,n)):new TypeError("Callback should be a function."):new TypeError("Channel name should be String, Symbol, Number.")}subscribeOnce(t,e){return this.__logging("subscribeOnce",{channel:t,callback:e}),this.__isValidChannel(t)?this.__isValidCallback(e)?(this.__createChannel(t),this.__createSubscription(t,e)):new TypeError("Callback should be a function."):new TypeError("Channel name should be String, Symbol, Number.")}unsubscribe(t,e){return void 0!==e?this.unsubscribeByChannelAndCallback(t,e):this.__isValidCallback(t)?this.unsubscribeByCallback(t):this.__isValidToken(t)?this.unsubscribeByToken(t):0}unsubscribeByCallback(t){if(this.__logging("unsubscribeByCallback",{callback:t}),!this.__isValidCallback(t))return 0;let e=0;return this.__subscriptions.forEach(n=>{Ft(n).forEach(r=>{Pt(n[r].callback,t)&&(delete n[r],e+=1)})}),e}unsubscribeByChannelAndCallback(t,e){if(this.__logging("unsubscribeByChannelAndCallback",{callback:e}),!this.hasSubscription(t))return 0;const n=this.__subscriptions.get(t);let r=0;return Ft(n).forEach(t=>{Pt(n[t].callback,e)&&(delete n[t],r+=1)}),r}unsubscribeByToken(t){if(this.__logging("unsubscribeByToken",{token:t}),!this.__isValidToken(t))return 0;let e=0;return this.__subscriptions.forEach(n=>{t in n&&(delete n[t],e+=1)}),e}}export default Ut;export{Ut as PublishSubscribe};